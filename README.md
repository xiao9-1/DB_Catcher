# DB_Catcher

**DB_Catcher** — это приложение для периодического опроса MSSQL базы данных и отображения результатов через веб-интерфейс. Оно построено на базе Docker Compose и включает два контейнера: один для MSSQL сервера и другой для приложения на Python, которое обрабатывает запросы и отображает результаты.

## Описание

Приложение состоит из двух основных компонентов:

1. **Python приложение**:
   - Осуществляет периодический опрос MSSQL базы данных.
   - Сохраняет результаты опросов в CSV-файлы.
   - Запускает веб-сервер для отображения списка файлов, их содержимого и информации о последних запросах.

2. **MSSQL сервер**:
   - Внутри контейнера поднимается база данных, в которую Python-приложение делает SQL-запросы.

## Установка и запуск

1. Клонируйте репозиторий:

```bash
git clone https://github.com/xiao9-1s/DB_Catcher.git
```
```bash
cd DB_Catcher
```

2. Перейдите в директорию проекта и выполните команду для сборки docker-compose

```bash
docker-compose up -d
```

После этого будут запущены два контейнера:

1) MSSQL сервер.
2) Python приложение, которое опрашивает базу данных и отображает результаты через веб-интерфейс.

3. Воспользуйтесь ссылкой ниже, чтобы увидеть веб-интерфейс, где будут отображаться:

-Список файлов (с возможностью их просмотра и скачивания).
-Содержимое выбранного файла.
-Информация о последнем запросе к базе данных.

```bash
http://localhost:8090
```

## Использование

Приложение автоматически опрашивает базу данных через определенные интервалы времени, которые можно задать с помощью переменных окружения:

- **`DB_HOST`**: хост базы данных (по умолчанию: mssql).
- **`DB_PORT`**: порт для подключения (по умолчанию: 1433).
- **`DB_USER`**: пользователь базы данных.
- **`DB_PASSWORD`**: пароль для базы данных.
- **`DB_NAME`**: имя базы данных.
- **`DATA_DIR`**: директория для сохранения данных.
- **`SQL_QUERY`**: SQL-запрос для выполнения.
- **`QUERY_INTERVAL`**: интервал опроса (в секундах).
- **`FILE_LIFETIME`**: время жизни сохраненных файлов (в секундах).

- Если вы изменяете переменные окружения, необходимо пересобрать docker-compose:

```bash
docker-compose down
```
```bash
docker-compose up -d --build
```

## Очистка данных

По умолчанию данные сохраняются при перезапуске контейнеров, так как тома для базы данных сохраняются на вашем локальном диске.

Если вам необходимо перезапустить MS SQL Server с чистыми данными:

Удалите контейнеры используя команду ниже, и запустите вновь.
```bash
docker-compose down -v
```

